#!/usr/bin/env ruby

require 'soundcli'

begin
  Settings::init(ARGV)
  app = SoundCLI.new

  if ARGV.length < 1
    puts app.usage
    Process.exit 1
  end

  if app.features.include? ARGV[0].to_sym
    if ARGV[1]
      app.method(ARGV[0]).call(ARGV[1..-1])
    else
      app.method(ARGV[0]).call
    end
  else
    # stream if the only argument is a soundcloud link or an id
    if ARGV[0][/^http:\/\/soundcloud/] or ARGV[0][/[0-9]+/]
      app.stream [ARGV[0]]
    else
      $stderr.puts "No such action: #{ARGV[0]}"
      app.usage and Process.exit(1)
    end
  end
rescue Interrupt
ensure
  bye = [
    "Fare thee well, fare thee well, you that was once dear to me.\n   --- Think of me with kindness",
    "You say goodbye and I say hello.\n   --- Hello, Goodbye",
    "And in the end the love you take is equal to the love you make\n   --- The End",
    "Whisper words of wisdom, let it be.\n    --- Let it be",
    "Sugar plum fairy, sugar plum fairy.\n    --- A day in the life",
  ]

  Helpers::sayn("\n"+bye[rand(bye.length)], :normal)
end
